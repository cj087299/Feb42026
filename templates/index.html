<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VZT Accounting - QuickBooks Cash Flow</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/ai-chat.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <a href="/" class="logo">ðŸ’° VZT Accounting</a>
            <nav class="nav" id="mainNav">
                <a href="/">Home</a>
                <a href="/invoices">Invoices</a>
                <a href="/cashflow">Cash Flow</a>
                <a href="/health">Status</a>
                <a href="#" onclick="logout(); return false;">Logout</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h1>Welcome to VZT Accounting</h1>
            <p>Manage your QuickBooks Online invoices and project your cash flow with ease</p>
            <p id="userInfo" style="font-size: 0.9rem; color: var(--text-secondary);"></p>
        </section>

        <div class="cards-grid">
            <a href="/invoices" class="card">
                <div class="card-icon">ðŸ“„</div>
                <h2>Invoice Management</h2>
                <p>View, filter, and sort your QuickBooks Online invoices. Track payment status and manage your receivables efficiently.</p>
                <span class="card-link">View Invoices â†’</span>
            </a>

            <a href="/cashflow" class="card">
                <div class="card-icon">ðŸ“Š</div>
                <h2>Cash Flow Projection</h2>
                <p>Get AI-powered cash flow projections based on your invoices. Plan ahead with accurate financial forecasts.</p>
                <span class="card-link">View Projections â†’</span>
            </a>
            
            <a href="/audit" class="card" id="auditCard" style="display: none;">
                <div class="card-icon">ðŸ“‹</div>
                <h2>Audit Log</h2>
                <p>Track all system activities and changes. Monitor user actions and system events.</p>
                <span class="card-link">View Audit Log â†’</span>
            </a>
            
            <a href="/users" class="card" id="usersCard" style="display: none;">
                <div class="card-icon">ðŸ‘¥</div>
                <h2>User Management</h2>
                <p>Manage system users, roles, and permissions. Control access to different parts of the application.</p>
                <span class="card-link">Manage Users â†’</span>
            </a>

            <a href="/health" class="card">
                <div class="card-icon">âœ…</div>
                <h2>System Status</h2>
                <p>Check the health and status of the service. View API endpoints and service information.</p>
                <span class="card-link">Check Status â†’</span>
            </a>
        </div>

        <section style="margin-top: 3rem; padding: 2rem; background: white; border-radius: 12px;">
            <h2 style="margin-bottom: 1rem;">Key Features</h2>
            <ul style="list-style-position: inside; color: var(--text-secondary); line-height: 2;">
                <li>ðŸ”— <strong>QuickBooks Online Integration</strong> - Seamlessly connect to your QBO account</li>
                <li>ðŸ¤– <strong>AI-Powered Predictions</strong> - Machine learning models predict payment dates</li>
                <li>ðŸ“ˆ <strong>Advanced Filtering</strong> - Filter invoices by date, customer, status, amount, and region</li>
                <li>ðŸ’¡ <strong>Smart Sorting</strong> - Sort by due date, amount, or customer</li>
                <li>ðŸ“Š <strong>Cash Flow Forecasting</strong> - Project your cash flow for the next 30, 60, or 90 days</li>
                <li>ðŸŽ¯ <strong>User-Friendly Interface</strong> - Clean, modern design for easy navigation</li>
            </ul>
        </section>
    </main>

    <script src="/static/js/common.js"></script>
    <script src="/static/js/ai-chat.js"></script>
    <script>
        // Load user info and show/hide cards based on role
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const user = await fetchAPI('/api/me');
                if (user) {
                    document.getElementById('userInfo').textContent = `Logged in as ${user.full_name || user.email} (${getRoleName(user.role)})`;
                    
                    const nav = document.getElementById('mainNav');
                    
                    // Show audit log link for admins
                    if (user.role === 'admin' || user.role === 'master_admin') {
                        document.getElementById('auditCard').style.display = 'block';
                        const auditLink = document.createElement('a');
                        auditLink.href = '/audit';
                        auditLink.textContent = 'Audit Log';
                        nav.insertBefore(auditLink, nav.lastElementChild);
                    }
                    
                    // Show users link for master admin
                    if (user.role === 'master_admin') {
                        document.getElementById('usersCard').style.display = 'block';
                        const usersLink = document.createElement('a');
                        usersLink.href = '/users';
                        usersLink.textContent = 'Users';
                        nav.insertBefore(usersLink, nav.lastElementChild);
                    }
                }
            } catch (error) {
                console.error('Failed to load user info:', error);
            }
        });
        
        function getRoleName(role) {
            const roleNames = {
                'view_only': 'View Only',
                'ap': 'Accounts Payable',
                'ar': 'Accounts Receivable',
                'admin': 'Admin',
                'master_admin': 'Master Admin'
            };
            return roleNames[role] || role;
        }
        
        async function logout() {
            try {
                await fetch('/api/logout', { method: 'POST' });
                window.location.href = '/login';
            } catch (error) {
                console.error('Logout failed:', error);
                window.location.href = '/login';
            }
        }
    </script>
</body>
</html>
