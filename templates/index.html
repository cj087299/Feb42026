{% extends "base.html" %}

{% block title %}VZT Accounting - QuickBooks Cash Flow{% endblock %}

{% block content %}
        <section class="hero">
            <img src="/static/img/hero-desktop.png"
                 srcset="/static/img/hero-mobile.png 400w,
                         /static/img/hero-tablet.png 800w,
                         /static/img/hero-desktop.png 1200w"
                 sizes="(max-width: 400px) 100vw,
                        (max-width: 800px) 100vw,
                        1200px"
                 alt="VZT Accounting Hero"
                 class="hero-image"
                 fetchpriority="high">
            <h1>Welcome to VZT Accounting</h1>
            <p>Professional Invoice Management & Cash Flow Projections for Energy Services</p>
            <p id="userInfo" style="font-size: 0.9rem; color: var(--text-secondary);"></p>
        </section>

        <div class="cards-grid">
            <a href="/invoices" class="card">
                <div class="card-icon">üìÑ</div>
                <h2>Invoice Management</h2>
                <p>View, filter, and sort your QuickBooks Online invoices. Track payment status and manage your receivables efficiently.</p>
                <span class="card-link">View Invoices ‚Üí</span>
            </a>

            <a href="/cashflow" class="card">
                <div class="card-icon">üìä</div>
                <h2>Cash Flow Projection</h2>
                <p>Get AI-powered cash flow projections based on your invoices. Plan ahead with accurate financial forecasts.</p>
                <span class="card-link">View Projections ‚Üí</span>
            </a>

            <a href="/liquidity" class="card">
                <div class="card-icon">üíß</div>
                <h2>Liquidity Dashboard</h2>
                <p>View high-level financial snapshot, liquidity ratios, and key metrics like AR, AP, and Bank Balance.</p>
                <span class="card-link">View Dashboard ‚Üí</span>
            </a>

            <a href="/reports" class="card">
                <div class="card-icon">üìà</div>
                <h2>Financial Reports</h2>
                <p>Generate Balance Sheet, Profit & Loss, Aging, and Transaction List reports. Compare time periods side-by-side.</p>
                <span class="card-link">View Reports ‚Üí</span>
            </a>
            
            <a href="/audit" class="card" id="auditCard" style="display: none;">
                <div class="card-icon">üìã</div>
                <h2>Audit Log</h2>
                <p>Track all system activities and changes. Monitor user actions and system events.</p>
                <span class="card-link">View Audit Log ‚Üí</span>
            </a>
            
            <a href="/users" class="card" id="usersCard" style="display: none;">
                <div class="card-icon">üë•</div>
                <h2>User Management</h2>
                <p>Manage system users, roles, and permissions. Control access to different parts of the application.</p>
                <span class="card-link">Manage Users ‚Üí</span>
            </a>
            
            <a href="/qbo-settings-v2" class="card" id="qboSettingsCard" style="display: none;">
                <div class="card-icon">‚öôÔ∏è</div>
                <h2>QuickBooks Settings</h2>
                <p>Manage QuickBooks Online credentials and connection settings. Configure API access for all users.</p>
                <span class="card-link">QBO Settings ‚Üí</span>
            </a>

            <a href="/health" class="card">
                <div class="card-icon">‚úÖ</div>
                <h2>System Status</h2>
                <p>Check the health and status of the service. View API endpoints and service information.</p>
                <span class="card-link">Check Status ‚Üí</span>
            </a>
        </div>

        <section style="margin-top: 3rem; padding: 2rem; background: white; border-radius: 12px;">
            <h2 style="margin-bottom: 2rem; text-align: center;">Key Features</h2>
            <div class="features-grid">
                <div class="feature-item">
                    <img src="/static/img/feature-qbo.png" alt="QuickBooks Integration" class="feature-image" loading="lazy">
                    <h3>QBO Integration</h3>
                    <p>Seamlessly connect to your QBO account for real-time data sync and management.</p>
                </div>
                <div class="feature-item">
                    <img src="/static/img/feature-ai.png" alt="AI Predictions" class="feature-image" loading="lazy">
                    <h3>AI-Powered Predictions</h3>
                    <p>Machine learning models predict payment dates to help you plan your cash flow effectively.</p>
                </div>
                <div class="feature-item">
                    <img src="/static/img/feature-cashflow.png" alt="Cash Flow" class="feature-image" loading="lazy">
                    <h3>Cash Flow Forecasting</h3>
                    <p>Project your cash flow for the next 30, 60, or 90 days with high accuracy.</p>
                </div>
                <div class="feature-item">
                    <img src="/static/img/feature-qbo.png" alt="Advanced Filtering" class="feature-image" loading="lazy">
                    <h3>Advanced Filtering</h3>
                    <p>Filter invoices by date, customer, status, amount, and region easily.</p>
                </div>
                <div class="feature-item">
                    <img src="/static/img/feature-ai.png" alt="Smart Sorting" class="feature-image" loading="lazy">
                    <h3>Smart Sorting</h3>
                    <p>Sort by due date, amount, or customer to prioritize your work.</p>
                </div>
                <div class="feature-item">
                    <img src="/static/img/feature-cashflow.png" alt="User-Friendly" class="feature-image" loading="lazy">
                    <h3>User-Friendly</h3>
                    <p>Clean, modern design built for efficiency and ease of use.</p>
                </div>
            </div>
        </section>
{% endblock %}

{% block extra_js %}
    <script>
        // Load user info and show/hide cards based on role
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const user = await fetchAPI('/api/me');
                if (user) {
                    document.getElementById('userInfo').textContent = `Logged in as ${user.full_name || user.email} (${getRoleName(user.role)})`;
                    
                    // Show audit log link for admins
                    if (user.role === 'admin' || user.role === 'master_admin') {
                        document.getElementById('auditCard').style.display = 'block';
                        document.getElementById('qboSettingsCard').style.display = 'block';
                    }
                    
                    // Show users and logs links for master admin
                    if (user.role === 'master_admin') {
                        document.getElementById('usersCard').style.display = 'block';
                    }
                }
            } catch (error) {
                console.error('Failed to load user info:', error);
            }
        });
        
        function getRoleName(role) {
            const roleNames = {
                'view_only': 'View Only',
                'ap': 'Accounts Payable',
                'ar': 'Accounts Receivable',
                'admin': 'Admin',
                'master_admin': 'Master Admin'
            };
            return roleNames[role] || role;
        }
    </script>
{% endblock %}
