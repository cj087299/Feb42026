{% extends "base.html" %}

{% block title %}VZT Accounting - QuickBooks Cash Flow{% endblock %}

{% block content %}
        <section class="hero">
            <h1>Welcome to VZT Accounting</h1>
            <p>Professional Invoice Management & Cash Flow Projections for Energy Services</p>
            <p id="userInfo" style="font-size: 0.9rem; color: var(--text-secondary);"></p>
        </section>

        <div class="cards-grid">
            <a href="/invoices" class="card">
                <div class="card-icon">ğŸ“„</div>
                <h2>Invoice Management</h2>
                <p>View, filter, and sort your QuickBooks Online invoices. Track payment status and manage your receivables efficiently.</p>
                <span class="card-link">View Invoices â†’</span>
            </a>

            <a href="/cashflow" class="card">
                <div class="card-icon">ğŸ“Š</div>
                <h2>Cash Flow Projection</h2>
                <p>Get AI-powered cash flow projections based on your invoices. Plan ahead with accurate financial forecasts.</p>
                <span class="card-link">View Projections â†’</span>
            </a>

            <a href="/liquidity" class="card">
                <div class="card-icon">ğŸ’§</div>
                <h2>Liquidity Dashboard</h2>
                <p>View high-level financial snapshot, liquidity ratios, and key metrics like AR, AP, and Bank Balance.</p>
                <span class="card-link">View Dashboard â†’</span>
            </a>

            <a href="/reports" class="card">
                <div class="card-icon">ğŸ“ˆ</div>
                <h2>Financial Reports</h2>
                <p>Generate Balance Sheet, Profit & Loss, Aging, and Transaction List reports. Compare time periods side-by-side.</p>
                <span class="card-link">View Reports â†’</span>
            </a>
            
            <a href="/audit" class="card" id="auditCard" style="display: none;">
                <div class="card-icon">ğŸ“‹</div>
                <h2>Audit Log</h2>
                <p>Track all system activities and changes. Monitor user actions and system events.</p>
                <span class="card-link">View Audit Log â†’</span>
            </a>
            
            <a href="/users" class="card" id="usersCard" style="display: none;">
                <div class="card-icon">ğŸ‘¥</div>
                <h2>User Management</h2>
                <p>Manage system users, roles, and permissions. Control access to different parts of the application.</p>
                <span class="card-link">Manage Users â†’</span>
            </a>
            
            <a href="/qbo-settings-v2" class="card" id="qboSettingsCard" style="display: none;">
                <div class="card-icon">âš™ï¸</div>
                <h2>QuickBooks Settings</h2>
                <p>Manage QuickBooks Online credentials and connection settings. Configure API access for all users.</p>
                <span class="card-link">QBO Settings â†’</span>
            </a>

            <a href="/health" class="card">
                <div class="card-icon">âœ…</div>
                <h2>System Status</h2>
                <p>Check the health and status of the service. View API endpoints and service information.</p>
                <span class="card-link">Check Status â†’</span>
            </a>
        </div>

        <section style="margin-top: 3rem; padding: 2rem; background: white; border-radius: 12px;">
            <h2 style="margin-bottom: 1rem;">Key Features</h2>
            <ul style="list-style-position: inside; color: var(--text-secondary); line-height: 2;">
                <li>ğŸ”— <strong>QuickBooks Online Integration</strong> - Seamlessly connect to your QBO account</li>
                <li>ğŸ¤– <strong>AI-Powered Predictions</strong> - Machine learning models predict payment dates</li>
                <li>ğŸ“ˆ <strong>Advanced Filtering</strong> - Filter invoices by date, customer, status, amount, and region</li>
                <li>ğŸ’¡ <strong>Smart Sorting</strong> - Sort by due date, amount, or customer</li>
                <li>ğŸ“Š <strong>Cash Flow Forecasting</strong> - Project your cash flow for the next 30, 60, or 90 days</li>
                <li>ğŸ¯ <strong>User-Friendly Interface</strong> - Clean, modern design for easy navigation</li>
            </ul>
        </section>
{% endblock %}

{% block extra_js %}
    <script>
        // Load user info and show/hide cards based on role
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const user = await fetchAPI('/api/me');
                if (user) {
                    document.getElementById('userInfo').textContent = `Logged in as ${user.full_name || user.email} (${getRoleName(user.role)})`;
                    
                    // Show audit log link for admins
                    if (user.role === 'admin' || user.role === 'master_admin') {
                        document.getElementById('auditCard').style.display = 'block';
                        document.getElementById('qboSettingsCard').style.display = 'block';
                    }
                    
                    // Show users and logs links for master admin
                    if (user.role === 'master_admin') {
                        document.getElementById('usersCard').style.display = 'block';
                    }
                }
            } catch (error) {
                console.error('Failed to load user info:', error);
            }
        });
        
        function getRoleName(role) {
            const roleNames = {
                'view_only': 'View Only',
                'ap': 'Accounts Payable',
                'ar': 'Accounts Receivable',
                'admin': 'Admin',
                'master_admin': 'Master Admin'
            };
            return roleNames[role] || role;
        }
    </script>
{% endblock %}
